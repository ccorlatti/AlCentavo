<?php
/*
 *  $Id: Standard.php 7 2010-05-19 01:23:44Z corlatti@gmail.com $
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * This software consists of voluntary contributions made by many individuals
 * and is licensed under the LGPL. For more information, see
 * <http://www.phpdoctrine.org>.
 */

/**
 * Doctrine_Search_Analyzer_Standard
 *
 * @package     Doctrine
 * @subpackage  Search
 * @author      Konsta Vesterinen <kvesteri@cc.hut.fi>
 * @license     http://www.opensource.org/licenses/lgpl-license.php LGPL
 * @version     $Revision: 7 $
 * @link        www.phpdoctrine.org
 * @since       1.0
 */
class Doctrine_Search_Analyzer_Standard extends Doctrine_Search_Analyzer implements Doctrine_Search_Analyzer_Interface
{
    protected static $_stopwords = array('el',
											'la',
											'los',
											'les',
											'las',
											'de',
											'del',
											'a',
											'ante',
											'con',
											'en',
											'para',
											'por',
											'y',
											'o',
											'u',
											'tu',
											'te',
											'ti',
											'le',
											'que',
											'al',
											'ha',
											'un',
											'han',
											'lo',
											'su',
											'una',
											'estas',
											'esto',
											'este',
											'es',
											'tras',
											'suya',
											'a',
											'acá',
											'ahí',
											'ajena',
											'ajenas',
											'ajeno',
											'ajenos',
											'al',
											'algo',
											'algún',
											'alguna',
											'algunas',
											'alguno',
											'algunos',
											'allá',
											'alli',
											'allí',
											'ambos',
											'ampleamos',
											'ante',
											'antes',
											'aquel',
											'aquella',
											'aquellas',
											'aquello',
											'aquellos',
											'aqui',
											'aquí',
											'arriba',
											'',
											'asi',
											'atras',
											'aun',
											'aunque',
											'bajo',
											'bastante',
											'bien',
											'cabe',
											'cada',
											'casi',
											'cierta',
											'ciertas',
											'cierto',
											'ciertos',
											'como',
											'cómo',
											'con',
											'conmigo',
											'conseguimos',
											'conseguir',
											'consigo',
											'consigue',
											'consiguen',
											'consigues',
											'contigo',
											'contra',
											'cual',
											'cuales',
											'cualquier',
											'cualquiera',
											'cualquieras',
											'cuancuán',
											'cuando',
											'cuanta',
											'cuánta',
											'cuantas',
											'cuántas',
											'cuanto',
											'cuánto',
											'cuantos',
											'cuántos',
											'de',
											'dejar',
											'del',
											'demás',
											'demas',
											'demasiada',
											'demasiadas',
											'demasiado',
											'demasiados',
											'',
											'dentro',
											'desde',
											'donde',
											'dos',
											'el',
											'él',
											'ella',
											'ellas',
											'',
											'ello',
											'ellos',
											'empleais',
											'emplean',
											'emplear',
											'empleas',
											'empleo',
											'en',
											'encima',
											'entonces',
											'entre',
											'era',
											'eramos',
											'eran',
											'eras',
											'eres',
											'es',
											'esa',
											'esas',
											'ese',
											'eso',
											'esos',
											'esta',
											'estaba',
											'estado',
											'estais',
											'estamos',
											'estan',
											'estar',
											'estas',
											'este',
											'esto',
											'estos',
											'estoy',
											'etc',
											'fin',
											'fue',
											'fueron',
											'fui',
											'fuimos',
											'gueno',
											'ha',
											'hace',
											'haceis',
											'hacemos',
											'hacen',
											'hacer',
											'haces',
											'hacia',
											'hago',
											'hasta',
											'incluso',
											'intenta',
											'intentais',
											'intentamos',
											'intentan',
											'intentar',
											'intentas',
											'intento',
											'ir',
											'jamás',
											'junto',
											'juntos',
											'la',
											'largo',
											'las',
											'lo',
											'los',
											'mas',
											'más',
											'me',
											'menos',
											'mi',
											'mía',
											'mia',
											'mias',
											'mientras',
											'mio',
											'mío',
											'mios',
											'mis',
											'misma',
											'mismas',
											'mismo',
											'mismos',
											'modo',
											'mucha',
											'muchas',
											'muchísima',
											'muchísimas',
											'muchísimo',
											'muchísimos',
											'mucho',
											'muchos',
											'muy',
											'nada',
											'ni',
											'ningun',
											'ninguna',
											'ningunas',
											'ninguno',
											'ningunos',
											'no',
											'nos',
											'nosotras',
											'nosotros',
											'nuestra',
											'nuestras',
											'nuestro',
											'nuestros',
											'nunca',
											'os',
											'otra',
											'otras',
											'otro',
											'otros',
											'para',
											'parecer',
											'pero',
											'poca',
											'pocas',
											'poco',
											'pocos',
											'podeis',
											'podemos',
											'poder',
											'podria',
											'podriais',
											'podriamos',
											'podrian',
											'podrias',
											'por',
											'por',
											'qué',
											'porque',
											'primero',
											'primero',
											'desde',
											'puede',
											'pueden',
											'puedo',
											'pues',
											'que',
											'qué',
											'querer',
											'quien',
											'quién',
											'quienes',
											'quienes',
											'quiera',
											'quienquiera',
											'quiza',
											'quizas',
											'sabe',
											'sabeis',
											'sabemos',
											'saben',
											'saber',
											'sabes',
											'se',
											'segun',
											'ser',
											'si',
											'sí',
											'siempre',
											'siendo',
											'sin',
											'sín',
											'sino',
											'so',
											'sobre',
											'sois',
											'solamente',
											'solo',
											'somos',
											'soy',
											'sr',
											'sra',
											'sres',
											'esta',
											'su',
											'sus',
											'suya',
											'suyas',
											'suyo',
											'suyos',
											'tal',
											'tales',
											'también',
											'tambien',
											'tampoco',
											'tan',
											'tanta',
											'tantas',
											'tanto',
											'tantos',
											'te',
											'teneis',
											'tenemos',
											'tener',
											'tengo',
											'ti',
											'tiempo',
											'tiene',
											'tienen',
											'toda',
											'todas',
											'todo',
											'todos',
											'tomar',
											'trabaja',
											'trabajais',
											'trabajamos',
											'trabajan',
											'trabajar',
											'trabajas',
											'trabajo',
											'tras',
											'tú',
											'tu',
											'tus',
											'tuya',
											'tuyo',
											'tuyos',
											'ultimo',
											'un',
											'una',
											'unas',
											'uno',
											'unos',
											'usa',
											'usais',
											'usamos',
											'usan',
											'usar',
											'usas',
											'uso',
											'usted',
											'ustedes',
											'va',
											'vais',
											'valor',
											'vamos',
											'van',
											'varias',
											'varios',
											'vaya',
											'verdad',
											'verdadera',
											'vosotras',
											'vosotros',
											'voy',
											'vuestra',
											'vuestras',
											'vuestro',
											'vuestros',
											'y',
											'ya',
											'yo',
											'como',
											'cómo',
											'hacer',
											'se',
											'tengo');

    public function analyze($text, $encoding = null)
    {
        $text = preg_replace('/[\'`´"]/', '', $text);
        $text = Doctrine_Inflector::unaccent($text);
        $text = preg_replace('/[^A-Za-z0-9]/', ' ', $text);
        $text = str_replace('  ', ' ', $text);

        $terms = explode(' ', $text);
        
        $ret = array();
        if ( ! empty($terms)) {
            foreach ($terms as $i => $term) {
                if (empty($term)) {
                    continue;
                }
                $lower = strtolower(trim($term));

                if (in_array($lower, self::$_stopwords)) {
                    continue;
                }

                $ret[$i] = $lower;
            }
        }
        return $ret;
    }
}
